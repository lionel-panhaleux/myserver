---
- name: Deploy the KRCG rulings website on rulings.krcg.org
  hosts: krcg_gra
  become: true
  gather_facts: false
  vars:
    username: lpanhaleux
  roles:
    - role: create-ssh-key
    - role: register-ssl
      rs_server_name: rulings.krcg.org
    - role: postgresql-database
      pd_database: "vtes-rulings"
      pd_user: "vtes-rulings"
      pd_password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        31636335393633656439316566373265613264306465306362646633323033366137326636353230
        3038303263313132343539323134653837346262643161360a633662303633353032643663613732
        61386166663161653438373839646333313065623336393939646161623039313136653237383932
        3038333562333961320a393365383931386565336665366432313865363031626136643439333961
        31336237313432333137356466666264383564633239306135313531623630616164623931656131
        3966316264613031386633393431626139623731333232353336
    - role: quart-backend
      qb_package: vtes-rulings
      qb_asgi_entrypoint: "vtesrulings:app"
      qb_server_name: rulings.krcg.org
      qb_port: 8004
      qb_env:
        PYTHONOPTIMIZE: 1
        DISCORD_SERVER_ID: "887471681277399091"
        DB_USER: "vtes-rulings"
        SITE_URL_BASE: "https://rulings.krcg.org"
        VTESCSV_GITHUB_BRANCH: "main"
        DISCORD_WEBHOOK: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37386533326539616530396531303136303635663136306332303664323163646534613736623266
          3863336664353031616665323639323334626133653832610a613236656462333232323963306430
          32303430663666613666323239663534663132653863646339313364316132623936653537323639
          6538356238353338350a356530306365353034346338303361643635326438656561613165306536
          32393233316364363935396538616338643030306162346362323661363762653537613931613131
          34663433646466313966313933663631616333363566363535396261633137363662356332623733
          30633063323030323365356430663539626237373534343230313935303961313039313435396339
          36316337353631623462393266623339313162623661623234626362343238383263633263303531
          66653166643632376234633133356465313838306666626566643431613665616435616232326663
          3231396530373631336134393930326262346335396539303231
        SESSION_SECRET_KEY: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63653861663364656634653661643034373634393135333763316439623633376431613761313936
          3736653166373034646162653237643037656636363233650a313639393462386131616530643162
          33343164653537643135666566383431396138313263373062653031376337653433616238393863
          3463373763346664380a306264323931643139666264353933313337383836393634666361613266
          63653165643139613432393133363461343336313665346264613934303236356232633766323734
          31643465366638343234373164396561316437323033323262666337633461353432313861643336
          65386561333564306466636337633336333464613238373533636132356331306634373963393331
          35643764346435376164
        DB_PWD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31636335393633656439316566373265613264306465306362646633323033366137326636353230
          3038303263313132343539323134653837346262643161360a633662303633353032643663613732
          61386166663161653438373839646333313065623336393939646161623039313136653237383932
          3038333562333961320a393365383931386565336665366432313865363031626136643439333961
          31336237313432333137356466666264383564633239306135313531623630616164623931656131
          3966316264613031386633393431626139623731333232353336