---
- name: Deploy the Archon beta website on archon.krcg.org
  hosts: krcg_gra
  become: true
  gather_facts: false
  vars:
      username: lpanhaleux
  roles:
    - role: register-ssl
      rs_server_name: archon.krcg.org
    - role: postgresql-database
      pd_database: archondb
      pd_user: archon
      pd_password: !vault |
        $ANSIBLE_VAULT;1.1;AES256
        65386331306334643731636637323330666433623331363637353435383630663163616664383461
        6432356661623538303236386333326538376466383761310a306661396163323830653836633363
        33346638353431613164653732633762363837383135373831333061636531616162303763663235
        3436633763343863310a663539643266346562353361323637666461306639373863626561353833
        63373634386233616363666336356566643237393364366432306130663765346437
    - role: fastapi-backend
      fb_package: vtes-archon
      fb_asgi_entrypoint: "archon.app.main:app"
      fb_server_name: archon.krcg.org
      fb_open_location: "/api"
      fb_port: 8007
      fb_env:
          PYTHONOPTIMIZE: 1
          SITE_URL_BASE: "https://archon.krcg.org"
          DB_USER: "archon"
          MAIL_SERVER: "smtp.gmail.com"
          MAIL_PORT: "587"
          MAIL_USERNAME: "codex.of.the.damned@gmail.com"
          MAIL_FROM: "codex.of.the.damned@gmail.com"
          MAIL_FROM_NAME: "Archon Beta"
          DB_PWD: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            65386331306334643731636637323330666433623331363637353435383630663163616664383461
            6432356661623538303236386333326538376466383761310a306661396163323830653836633363
            33346638353431613164653732633762363837383135373831333061636531616162303763663235
            3436633763343863310a663539643266346562353361323637666461306639373863626561353833
            63373634386233616363666336356566643237393364366432306130663765346437
          TOKEN_SECRET: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            61383066613163323131363337633463343534376464353933656363656666666664316639643438
            3536633435633832343064626335353333616662626563330a376133343538373834393136653434
            66353232373738383165323633303536313065376431623435303965336233623134373231616633
            6139626237316136360a326364356638313665303835373035653137663238363033646462366465
            64626136643439323564316435626430326438313064336537303131306435303364343235636162
            66386437353536303234356166663463396439613961303732303561333961393764343733356339
            66353863333238396437626638316532623765396364303735333831383465646362396538336665
            65356466383866633731
          VEKN_LOGIN: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            31313530343734316632663536656335313730333831643435633835653866316165656539313531
            3330363764316266616662623236623834363038343336640a343833376234333930633436386633
            36633365636461376162643166616539653434356231633038323361396632626436363364313136
            3330363063633431330a613130316231313264353037333162643031363162326436323736346664
            3865
          VEKN_PASSWORD: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            38613563333335646432643033353835643035343730383732653066663764636236653466336366
            6265396161326334646361393339343761356233313462610a663762346235663531323334393439
            34383830633932643339393433316336316535663136663933613935313234333537363131643839
            6663396661336133360a626565623334346537353165323564616338636637343736376665316630
            3030
          DISCORD_CLIENT_ID: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            30626263313061373966623834653833326461363932376363336637636465316637643639376430
            3131613334373730646230366535653137343939643762300a633262653865653961356131383339
            33643465313837313836653162333636633534623431333732633366303039356635636434623033
            3062386436636265390a646539303163326161613436306666666264356364636332623865633264
            38343063326362643435373434363134383865393530383365386664353564366531
          DISCORD_CLIENT_SECRET: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            63366230363231333165323633346165306434306161373831376435653237633531353430306464
            6662313335373164366337316335333662323534313437300a316435623530373933343064383963
            63666437336261373063613261666635333032303538363739663639613239626433386232663336
            3962626430353230650a613939643239383362343761613962356133643139386234303733633263
            34333032323733646531313433656139626361386363343361353430626633386530326666386638
            6566643331366133653432333136366438623038323133653532
          HASH_KEY: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            31326335313565376665306262373463336463363834373339323362333237633836363936623966
            6639396533653161643936393465313365323930373937300a313662633035653366636130313639
            35616663366563373930333935303336323134333437653937336563623638343135303064663032
            6666323534643864620a353730373334386636636632393833383866383065636331393735366230
            30336633666131623064376465616238613066656462323763396230613931346331323363353034
            3238616362356136383439316661613865303634663863393732
          MAIL_PASSWORD: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            33393536373233356135613333343238663831373362633664623738383163313466653030356235
            3461623964303062303239636135343663386464316464310a613365363437616534613935646139
            61663162623935373165616536373133353763303936373566323539303736323136373432396131
            3565633965366434650a623437383539313939356334663431356163653033353961383938656532
            32316230316265383438303863643031363063633265366666616136306534663732
          SESSION_KEY: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            30343136383465373931383530366436633337313237633834333337356639353661303165316537
            3661623666353839373630346430343033633462383861650a383433636532343336616661663937
            66643630623836346436326661616535363739613031666534333435643764366233343730346238
            3662306232383634310a343736616336393539363239393338366237303264643635316639643364
            39313836363763653534336532333466363130323936353164333165666162646331313631343563
            38646163343266333834333338343334353961363037613135353336316531613233613562386234
            65336438643437333533333036303331656430616138613163356432383538393463366565353530
            32636130616538353161
